# Workspace Browser 自动化测试报告

## 1. 测试目标
验证 `server.py` 的核心功能在可控数据集下可用，包括：
- 目录列表访问
- 隐藏文件过滤
- 目录重定向逻辑（含 query 参数分支）
- 文本文件预览
- 二进制文件回退为原始响应

## 2. 测试环境
- 测试日期：2026-02-28
- 代码版本：当前工作区 `master`（包含 README 提交后状态）
- 运行方式：
  - 启动服务实例 A：`python3 server.py`（默认配置，18888）
  - 启动服务实例 B（测试专用）：
    `python3 -c "import server; server.PORT=18901; server.WORKSPACE='/tmp/wsb_test'; server.main()"`
- 测试数据集：`/tmp/wsb_test`
  - 目录：`dirA/`, `dirB/`
  - 文本文件：`readme.md`, `app.py`, `dirA/note.txt`
  - 隐藏文件：`.hidden.txt`
  - 二进制文件：`blob.bin`

## 3. 自动化测试用例与结果

| 编号 | 用例 | 结果 |
|---|---|---|
| T1 | 根目录 `/` 返回 `200 OK` | PASS |
| T2 | 隐藏文件 `.hidden.txt` 不出现在目录列表 | PASS |
| T3 | 可见文件（`readme.md`）出现在目录列表 | PASS |
| T4 | 访问无尾斜杠目录 `/dirA` 返回 `301` | PASS |
| T5 | `301` 跳转目标为 `/dirA/` | PASS |
| T6 | 带 query 的目录访问 `/dirA?x=1` 返回 `200`（不重定向） | PASS |
| T7 | 文本文件 `/readme.md` 返回 `200` | PASS |
| T8 | 文本文件预览响应类型为 `text/html; charset=utf-8` | PASS |
| T9 | 文本预览页面包含 CodeMirror 关键字 | PASS |
| T10 | 二进制文件 `/blob.bin` 返回 `200` | PASS |
| T11 | 二进制文件未被强制转成 HTML 预览 | PASS |

汇总：**11/11 通过，0 失败**。

## 4. 结论
当前版本在本地自动化冒烟测试范围内运行正常，目录浏览和预览主流程可用，未发现阻断级缺陷。

## 5. 优化点（按优先级）

1. 配置外置化（高优先级）
- 问题：`PORT`、`WORKSPACE` 硬编码在代码中。
- 建议：支持命令行参数或环境变量（如 `WORKSPACE`, `PORT`），减少改码部署成本。

2. 增加安全控制（高优先级）
- 问题：默认 `0.0.0.0` 暴露，且无鉴权。
- 建议：默认绑定 `127.0.0.1`；增加基础认证或 token；反向代理层加白名单。

3. 页面模板与静态资源拆分（中优先级）
- 问题：HTML/CSS/JS 内嵌在 Python 字符串中，维护复杂。
- 建议：拆分为模板与静态文件目录，提升可维护性与可测试性。

4. 补充自动化测试脚本入库（中优先级）
- 问题：当前测试是临时执行，未沉淀为可复用测试。
- 建议：新增 `tests/`（例如 `pytest + requests`），接入 CI。

5. 预览性能优化（中优先级）
- 问题：文本预览使用 `viewportMargin: Infinity`，大文件时可能卡顿。
- 建议：限制大文件预览大小（如 1-2MB），并启用分段加载或只读分页。

6. 前端可用性细节（低优先级）
- 问题：搜索框 placeholder 为空；部分 JS 在文件预览页含未使用逻辑。
- 建议：补齐 placeholder，清理无效脚本，减少页面负担。
